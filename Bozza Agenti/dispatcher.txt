:- dynamic drone/1.
:- dynamic next_drone/2.
:- dynamic active_drone/1.
:- dynamic state/1.

drone(drone1).
drone(drone2).
next_drone(drone1, drone2).
next_drone(drone2, drone1).
active_drone(null).
state(wakeup).

turn_on_system :- state(wakeup).
turn_on_systemI :> 
    retract(state(S)), 
    nl,
    write('faccio partire la perlustrazione!'),
    messageA(drone1, send_message(activate, dispatcher)).

im_activeE(Drone) :> 
    retract(active_drone(null)),
    assert(active_drone(Drone)), 
    nl,
    write(Drone),
    write(' attivo').

im_rechargingE(Drone) :>
    active_drone(Drone),
    retract(active_drone(Drone)),
    assert(active_drone(null)),
    next_drone(Drone, DroneNext),
    messageA(DroneNext, send_message(activate, dispatcher)),
    nl,
    write(Drone), write(' scarico, potenziale sostituto: '),write(DroneNext), write(' inviata').

report_emergencyE(Loc, Type) :> 
    nl,
    write('emergenza a '), write(Loc), write(' di tipo '), write(Type).

call_emergencyE(Loc, null) :> 
    nl,
    write('!!chiamata di emergenza!!: chiedo ricognizione a  '),
    active_drone(Drone),
    messageA(Drone, send_message(request_recognition(Loc), dispatcher)),
    write(Drone).