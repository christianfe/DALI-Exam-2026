sequenceDiagram
title Soccorso urbano
autonumber

participant Dispatcher
participant DroneScout
participant AmbulanceUnit
participant FireFighter

alt Segnalazione esterna
  Dispatcher->Dispatcher: call_emergency(Loc, Type)
else Avvistamento drone
  alt avvistato incendio
    DroneScout->Dispatcher: report_emergency(Loc, fire)
  else avvistato incidente
    DroneScout->Dispatcher: report_emergency(Loc, ambulance)
  end
end

alt dispatcher non conosce il tipo di emergenza
  Dispatcher->DroneScout: request_recognition(Loc)
  DroneScout->Dispatcher: report_emergency(Loc, Type)
end

alt emergenza feriti
  Dispatcher->AmbulanceUnit: dispatch(Loc)
  alt richiesta accettata
    AmbulanceUnit->Dispatcher: ambulance_ack(dispatch, Loc)
  else richiesta non accettata
    AmbulanceUnit->Dispatcher: dispatch_refused(Loc, Reason, AmbulanceUnit)
  end
else emergenza incendio
  Dispatcher->FireFighter: dispatch(Loc)
  alt richiesta accettata
    FireFighter->Dispatcher: fireFighter_ack(dispatch, Loc)
  else richiesta non accettata
    FireFighter->Dispatcher: dispatch_refused(Loc, Reason, FireFighter)
  end
end

group Intervento completato
  AmbulanceUnit->Dispatcher: report(emergency_retired, Loc, AmbulanceUnit)
  FireFighter->Dispatcher: report(emergency_retired, Loc, FireFighter)
end
