sequenceDiagram
title Soccorso urbano
autonumber

participant Dispatcher

participant DroneScout


participant AmbulanceUnit

participant FireRescueUnit

alt Segnalazione esterna
  Dispatcher->Dispatcher: call_emergency(Loc, Type)\n
else Avvistamento drone
  alt avvistato incendio
    DroneScout->Dispatcher: report_emergency(Loc, Type)
  else avvistato ferito
    DroneScout->Dispatcher: report_emergency(Loc, Type)
  end
end

alt dispatcher non conosce il tipo di emergenza
  Dispatcher->DroneScout: request_recognition(Loc)
  DroneScout->Dispatcher: report_emergency(Loc, Type)
end

alt emergenza feriti
  Dispatcher->AmbulanceUnit: dispatch(Loc)
  
  alt richiesta accettata
    
    AmbulanceUnit -> Dispatcher: ambulance_ack(dispatch, Loc)
  

  else richiesta non accettata
   
  AmbulanceUnit -> Dispatcher: dispatch_refused(Loc, Reason, AmbulanceUnit)
   
  end
  

  
else emergenza incendio
  Dispatcher->FireRescueUnit: dispatch(Loc)
  
    alt richiesta accettata
    
    FireRescueUnit -> Dispatcher: fireResque_ack(dispatch, Loc)
  

  else richiesta non accettata
   
  AmbulanceUnit -> Dispatcher: dispatch_refused(Loc, Reason, FireUnit)
   
  end
  
  
end

group Intervento Completato
  
  AmbulanceUnit->Dispatcher: report(emergency_retired, Loc, AmbulanceUnit)
  FireRescueUnit->Dispatcher: report(emergency_retired, Loc, FireUnit)
end
